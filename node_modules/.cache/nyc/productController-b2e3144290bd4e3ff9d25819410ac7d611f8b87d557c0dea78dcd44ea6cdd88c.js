'use strict';function cov_1c7b4pkkzb(){var path="C:\\Users\\Chotu\\DbprojectCRUD\\controllers\\productController.js";var hash="5e64b02f4f5ef03b7a6ed77bc4fc3e966bb333f2";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Chotu\\DbprojectCRUD\\controllers\\productController.js",statementMap:{"0":{start:{line:2,column:13},end:{line:2,column:46}},"1":{start:{line:3,column:14},end:{line:3,column:32}},"2":{start:{line:5,column:26},end:{line:5,column:59}},"3":{start:{line:7,column:0},end:{line:16,column:2}},"4":{start:{line:9,column:16},end:{line:9,column:32}},"5":{start:{line:10,column:4},end:{line:14,column:7}},"6":{start:{line:11,column:8},end:{line:11,column:30}},"7":{start:{line:11,column:16},end:{line:11,column:30}},"8":{start:{line:13,column:8},end:{line:13,column:26}},"9":{start:{line:18,column:0},end:{line:30,column:2}},"10":{start:{line:20,column:20},end:{line:20,column:39}},"11":{start:{line:22,column:4},end:{line:28,column:7}},"12":{start:{line:24,column:8},end:{line:25,column:26}},"13":{start:{line:25,column:12},end:{line:25,column:26}},"14":{start:{line:26,column:8},end:{line:26,column:26}},"15":{start:{line:97,column:0},end:{line:112,column:2}},"16":{start:{line:99,column:22},end:{line:99,column:43}},"17":{start:{line:101,column:4},end:{line:110,column:7}},"18":{start:{line:103,column:8},end:{line:108,column:9}},"19":{start:{line:104,column:12},end:{line:104,column:26}},"20":{start:{line:107,column:12},end:{line:107,column:72}},"21":{start:{line:116,column:0},end:{line:129,column:2}},"22":{start:{line:118,column:13},end:{line:118,column:57}},"23":{start:{line:120,column:4},end:{line:127,column:7}},"24":{start:{line:122,column:8},end:{line:123,column:26}},"25":{start:{line:123,column:12},end:{line:123,column:26}},"26":{start:{line:125,column:8},end:{line:125,column:26}},"27":{start:{line:131,column:0},end:{line:144,column:2}},"28":{start:{line:133,column:13},end:{line:133,column:57}},"29":{start:{line:135,column:4},end:{line:142,column:7}},"30":{start:{line:137,column:8},end:{line:138,column:26}},"31":{start:{line:138,column:12},end:{line:138,column:26}},"32":{start:{line:140,column:8},end:{line:140,column:62}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:7,column:19},end:{line:7,column:20}},loc:{start:{line:7,column:39},end:{line:16,column:1}},line:7},"1":{name:"(anonymous_1)",decl:{start:{line:10,column:15},end:{line:10,column:16}},loc:{start:{line:10,column:33},end:{line:14,column:5}},line:10},"2":{name:"(anonymous_2)",decl:{start:{line:18,column:21},end:{line:18,column:22}},loc:{start:{line:18,column:41},end:{line:30,column:1}},line:18},"3":{name:"(anonymous_3)",decl:{start:{line:22,column:57},end:{line:22,column:58}},loc:{start:{line:22,column:81},end:{line:28,column:5}},line:22},"4":{name:"(anonymous_4)",decl:{start:{line:97,column:14},end:{line:97,column:15}},loc:{start:{line:97,column:34},end:{line:112,column:1}},line:97},"5":{name:"(anonymous_5)",decl:{start:{line:101,column:21},end:{line:101,column:22}},loc:{start:{line:101,column:45},end:{line:110,column:5}},line:101},"6":{name:"(anonymous_6)",decl:{start:{line:116,column:17},end:{line:116,column:18}},loc:{start:{line:116,column:37},end:{line:129,column:1}},line:116},"7":{name:"(anonymous_7)",decl:{start:{line:120,column:67},end:{line:120,column:68}},loc:{start:{line:120,column:91},end:{line:127,column:5}},line:120},"8":{name:"(anonymous_8)",decl:{start:{line:131,column:17},end:{line:131,column:18}},loc:{start:{line:131,column:37},end:{line:144,column:1}},line:131},"9":{name:"(anonymous_9)",decl:{start:{line:135,column:32},end:{line:135,column:33}},loc:{start:{line:135,column:56},end:{line:142,column:5}},line:135}},branchMap:{"0":{loc:{start:{line:11,column:8},end:{line:11,column:30}},type:"if",locations:[{start:{line:11,column:8},end:{line:11,column:30}},{start:{line:11,column:8},end:{line:11,column:30}}],line:11},"1":{loc:{start:{line:24,column:8},end:{line:25,column:26}},type:"if",locations:[{start:{line:24,column:8},end:{line:25,column:26}},{start:{line:24,column:8},end:{line:25,column:26}}],line:24},"2":{loc:{start:{line:103,column:8},end:{line:108,column:9}},type:"if",locations:[{start:{line:103,column:8},end:{line:108,column:9}},{start:{line:103,column:8},end:{line:108,column:9}}],line:103},"3":{loc:{start:{line:122,column:8},end:{line:123,column:26}},type:"if",locations:[{start:{line:122,column:8},end:{line:123,column:26}},{start:{line:122,column:8},end:{line:123,column:26}}],line:122},"4":{loc:{start:{line:137,column:8},end:{line:138,column:26}},type:"if",locations:[{start:{line:137,column:8},end:{line:138,column:26}},{start:{line:137,column:8},end:{line:138,column:26}}],line:137}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"5e64b02f4f5ef03b7a6ed77bc4fc3e966bb333f2"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1c7b4pkkzb=function(){return actualCoverage;};}return actualCoverage;}cov_1c7b4pkkzb();const dfff=(cov_1c7b4pkkzb().s[0]++,require('dialogflow-fulfillment'));var express=(cov_1c7b4pkkzb().s[1]++,require('express'));//const functions = require('firebase-functions');
const{WebhookClient}=(cov_1c7b4pkkzb().s[2]++,require('dialogflow-fulfillment'));cov_1c7b4pkkzb().s[3]++;exports.products=function(req,res){cov_1c7b4pkkzb().f[0]++;let query=(cov_1c7b4pkkzb().s[4]++,Product.find({}));cov_1c7b4pkkzb().s[5]++;query.exec((err,product)=>{cov_1c7b4pkkzb().f[1]++;cov_1c7b4pkkzb().s[6]++;if(err){cov_1c7b4pkkzb().b[0][0]++;cov_1c7b4pkkzb().s[7]++;res.send(err);}else{cov_1c7b4pkkzb().b[0][1]++;}//If no errors, send them back to the client
cov_1c7b4pkkzb().s[8]++;res.json(product);});};cov_1c7b4pkkzb().s[9]++;exports.getproduct=function(req,res){cov_1c7b4pkkzb().f[2]++;var productId=(cov_1c7b4pkkzb().s[10]++,req.query.productId);cov_1c7b4pkkzb().s[11]++;Product.findById(mongoose.Types.ObjectId(productId),function(err,product){cov_1c7b4pkkzb().f[3]++;cov_1c7b4pkkzb().s[12]++;if(err){cov_1c7b4pkkzb().b[1][0]++;cov_1c7b4pkkzb().s[13]++;res.send(err);}else{cov_1c7b4pkkzb().b[1][1]++;}cov_1c7b4pkkzb().s[14]++;res.json(product);});};// exports.mproduct = function (req, res) {
//     var productId = req.query.productId;
//     Product.findById(mongoose.Types.ObjectId(productId), function (err, product) {
//         if (err)
//             res.send(err);
//         res.json(product);
//     });
// var intentMap = new Map();
// const agent = new dfff.WebhookClient({ request: req, response: res });
// let r=req.body.queryResult.parameters.product;
// //Product.find(function (err, product) {
//     function welcome(agent) {
//         agent.add("Welcome, Im a onlinestore agent!. which phone you want to choose?");
//         // product.forEach(element => {
//         //     //console.log(element.price);
//         //     agent.add(element.product_name);
//         // });
//     }
//     function bookFlight(agent) {
//         agent.add("hello")
//         //agent.add(product);
//     }
//     function fallback(agent) {
//         agent.add("I didn't understand");
//         agent.add("I'm sorry, can you try again?");
//     }
//     function getdetails(agent) {
//         agent.add("Iphone");
//         Product.find({ "product_name": r }, function (err, product) {
//         product.forEach(element => {
//             //console.log(element.price);
//             if (element.product_name === r) {
//                 agent.add("Name: "+element.product_name);
//                 agent.add("Price: "+element.price);
//                 agent.add("Category: "+element.category);
//             }
//         });
//      });
//     }
//     intentMap.set('Default Welcome Intent', welcome);
//     intentMap.set('Default Fallback Intent', fallback);
//     intentMap.set('BookFlight', bookFlight);
//     intentMap.set('Getdetails', getdetails);
//     agent.handleRequest(intentMap);
//});
//}
cov_1c7b4pkkzb().s[15]++;exports.add=function(req,res){cov_1c7b4pkkzb().f[4]++;var new_product=(cov_1c7b4pkkzb().s[16]++,new Product(req.body));cov_1c7b4pkkzb().s[17]++;new_product.save(function(err,product){cov_1c7b4pkkzb().f[5]++;cov_1c7b4pkkzb().s[18]++;if(err){cov_1c7b4pkkzb().b[2][0]++;cov_1c7b4pkkzb().s[19]++;res.send(err);}else{cov_1c7b4pkkzb().b[2][1]++;cov_1c7b4pkkzb().s[20]++;//If no errors, send it back to the client
res.json({message:"Product successfully added!",product});}});};cov_1c7b4pkkzb().s[21]++;exports.update=function(req,res){cov_1c7b4pkkzb().f[6]++;var id=(cov_1c7b4pkkzb().s[22]++,mongoose.Types.ObjectId(req.query.productId));cov_1c7b4pkkzb().s[23]++;Product.findOneAndUpdate({_id:id},req.body,{new:true},function(err,product){cov_1c7b4pkkzb().f[7]++;cov_1c7b4pkkzb().s[24]++;if(err){cov_1c7b4pkkzb().b[3][0]++;cov_1c7b4pkkzb().s[25]++;res.send(err);}else{cov_1c7b4pkkzb().b[3][1]++;}cov_1c7b4pkkzb().s[26]++;res.json(product);});};cov_1c7b4pkkzb().s[27]++;exports.delete=function(req,res){cov_1c7b4pkkzb().f[8]++;var id=(cov_1c7b4pkkzb().s[28]++,mongoose.Types.ObjectId(req.query.productId));cov_1c7b4pkkzb().s[29]++;Product.remove({_id:id},function(err,product){cov_1c7b4pkkzb().f[9]++;cov_1c7b4pkkzb().s[30]++;if(err){cov_1c7b4pkkzb().b[4][0]++;cov_1c7b4pkkzb().s[31]++;res.send(err);}else{cov_1c7b4pkkzb().b[4][1]++;}cov_1c7b4pkkzb().s[32]++;res.json({message:'Product successfully deleted'});});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb2R1Y3RDb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbImRmZmYiLCJyZXF1aXJlIiwiZXhwcmVzcyIsIldlYmhvb2tDbGllbnQiLCJleHBvcnRzIiwicHJvZHVjdHMiLCJyZXEiLCJyZXMiLCJxdWVyeSIsIlByb2R1Y3QiLCJmaW5kIiwiZXhlYyIsImVyciIsInByb2R1Y3QiLCJzZW5kIiwianNvbiIsImdldHByb2R1Y3QiLCJwcm9kdWN0SWQiLCJmaW5kQnlJZCIsIm1vbmdvb3NlIiwiVHlwZXMiLCJPYmplY3RJZCIsImFkZCIsIm5ld19wcm9kdWN0IiwiYm9keSIsInNhdmUiLCJtZXNzYWdlIiwidXBkYXRlIiwiaWQiLCJmaW5kT25lQW5kVXBkYXRlIiwiX2lkIiwibmV3IiwiZGVsZXRlIiwicmVtb3ZlIl0sIm1hcHBpbmdzIjoiQUFBQSxhLDZxS0FlWTsyRkFkWixLQUFNQSxDQUFBQSxJQUFJLDBCQUFHQyxPQUFPLENBQUMsd0JBQUQsQ0FBVixDQUFWLENBQ0EsR0FBSUMsQ0FBQUEsT0FBTywwQkFBR0QsT0FBTyxDQUFDLFNBQUQsQ0FBVixDQUFYLENBQ0E7QUFDQSxLQUFNLENBQUVFLGFBQUYsMkJBQW9CRixPQUFPLENBQUMsd0JBQUQsQ0FBM0IsQ0FBTixDLHdCQUVBRyxPQUFPLENBQUNDLFFBQVIsQ0FBbUIsU0FBVUMsR0FBVixDQUFlQyxHQUFmLENBQW9CLHlCQUVuQyxHQUFJQyxDQUFBQSxLQUFLLDBCQUFHQyxPQUFPLENBQUNDLElBQVIsQ0FBYSxFQUFiLENBQUgsQ0FBVCxDQUZtQyx3QkFHbkNGLEtBQUssQ0FBQ0csSUFBTixDQUFXLENBQUNDLEdBQUQsQ0FBTUMsT0FBTixHQUFrQixpREFDekIsR0FBR0QsR0FBSCxDQUFRLG9EQUFBTCxHQUFHLENBQUNPLElBQUosQ0FBU0YsR0FBVCxFQUFjLENBQXRCLGlDQUNBO0FBRnlCLHdCQUd6QkwsR0FBRyxDQUFDUSxJQUFKLENBQVNGLE9BQVQsRUFDSCxDQUpELEVBTUgsQ0FURCxDLHdCQVdBVCxP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RSw4QkFBWCxDQUFULEVBRUgsQ0FQRCxFQVNILENBYkQiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcbmNvbnN0IGRmZmYgPSByZXF1aXJlKCdkaWFsb2dmbG93LWZ1bGZpbGxtZW50Jyk7XHJcbnZhciBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xyXG4vL2NvbnN0IGZ1bmN0aW9ucyA9IHJlcXVpcmUoJ2ZpcmViYXNlLWZ1bmN0aW9ucycpO1xyXG5jb25zdCB7IFdlYmhvb2tDbGllbnQgfSA9IHJlcXVpcmUoJ2RpYWxvZ2Zsb3ctZnVsZmlsbG1lbnQnKTtcclxuXHJcbmV4cG9ydHMucHJvZHVjdHMgPSBmdW5jdGlvbiAocmVxLCByZXMpIHtcclxuXHJcbiAgICBsZXQgcXVlcnkgPSBQcm9kdWN0LmZpbmQoe30pO1xyXG4gICAgcXVlcnkuZXhlYygoZXJyLCBwcm9kdWN0KSA9PiB7XHJcbiAgICAgICAgaWYoZXJyKSByZXMuc2VuZChlcnIpO1xyXG4gICAgICAgIC8vSWYgbm8gZXJyb3JzLCBzZW5kIHRoZW0gYmFjayB0byB0aGUgY2xpZW50XHJcbiAgICAgICAgcmVzLmpzb24ocHJvZHVjdCk7XHJcbiAgICB9KTtcclxuXHJcbn07XHJcblxyXG5leHBvcnRzLmdldHByb2R1Y3QgPSBmdW5jdGlvbiAocmVxLCByZXMpIHtcclxuXHJcbiAgICB2YXIgcHJvZHVjdElkID0gcmVxLnF1ZXJ5LnByb2R1Y3RJZDtcclxuXHJcbiAgICBQcm9kdWN0LmZpbmRCeUlkKG1vbmdvb3NlLlR5cGVzLk9iamVjdElkKHByb2R1Y3RJZCksIGZ1bmN0aW9uIChlcnIsIHByb2R1Y3QpIHtcclxuXHJcbiAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgcmVzLnNlbmQoZXJyKTtcclxuICAgICAgICByZXMuanNvbihwcm9kdWN0KTtcclxuXHJcbiAgICB9KTtcclxuXHJcbn07XHJcblxyXG5cclxuLy8gZXhwb3J0cy5tcHJvZHVjdCA9IGZ1bmN0aW9uIChyZXEsIHJlcykge1xyXG5cclxuLy8gICAgIHZhciBwcm9kdWN0SWQgPSByZXEucXVlcnkucHJvZHVjdElkO1xyXG5cclxuLy8gICAgIFByb2R1Y3QuZmluZEJ5SWQobW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQocHJvZHVjdElkKSwgZnVuY3Rpb24gKGVyciwgcHJvZHVjdCkge1xyXG5cclxuLy8gICAgICAgICBpZiAoZXJyKVxyXG4vLyAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG4vLyAgICAgICAgIHJlcy5qc29uKHByb2R1Y3QpO1xyXG5cclxuLy8gICAgIH0pO1xyXG4gICAgLy8gdmFyIGludGVudE1hcCA9IG5ldyBNYXAoKTtcclxuICAgXHJcbiAgICAvLyBjb25zdCBhZ2VudCA9IG5ldyBkZmZmLldlYmhvb2tDbGllbnQoeyByZXF1ZXN0OiByZXEsIHJlc3BvbnNlOiByZXMgfSk7XHJcbiAgICBcclxuICAgIC8vIGxldCByPXJlcS5ib2R5LnF1ZXJ5UmVzdWx0LnBhcmFtZXRlcnMucHJvZHVjdDtcclxuICAgIC8vIC8vUHJvZHVjdC5maW5kKGZ1bmN0aW9uIChlcnIsIHByb2R1Y3QpIHtcclxuICAgIC8vICAgICBmdW5jdGlvbiB3ZWxjb21lKGFnZW50KSB7XHJcbiAgICAvLyAgICAgICAgIGFnZW50LmFkZChcIldlbGNvbWUsIEltIGEgb25saW5lc3RvcmUgYWdlbnQhLiB3aGljaCBwaG9uZSB5b3Ugd2FudCB0byBjaG9vc2U/XCIpO1xyXG4gICAgLy8gICAgICAgICAvLyBwcm9kdWN0LmZvckVhY2goZWxlbWVudCA9PiB7XHJcbiAgICAvLyAgICAgICAgIC8vICAgICAvL2NvbnNvbGUubG9nKGVsZW1lbnQucHJpY2UpO1xyXG4gICAgLy8gICAgICAgICAvLyAgICAgYWdlbnQuYWRkKGVsZW1lbnQucHJvZHVjdF9uYW1lKTtcclxuICAgIC8vICAgICAgICAgLy8gfSk7XHJcblxyXG4gICAgLy8gICAgIH1cclxuXHJcbiAgICAvLyAgICAgZnVuY3Rpb24gYm9va0ZsaWdodChhZ2VudCkge1xyXG4gICAgLy8gICAgICAgICBhZ2VudC5hZGQoXCJoZWxsb1wiKVxyXG4gICAgLy8gICAgICAgICAvL2FnZW50LmFkZChwcm9kdWN0KTtcclxuICAgIC8vICAgICB9XHJcblxyXG5cclxuICAgIC8vICAgICBmdW5jdGlvbiBmYWxsYmFjayhhZ2VudCkge1xyXG4gICAgLy8gICAgICAgICBhZ2VudC5hZGQoXCJJIGRpZG4ndCB1bmRlcnN0YW5kXCIpO1xyXG4gICAgLy8gICAgICAgICBhZ2VudC5hZGQoXCJJJ20gc29ycnksIGNhbiB5b3UgdHJ5IGFnYWluP1wiKTtcclxuICAgIC8vICAgICB9XHJcblxyXG5cclxuICAgIC8vICAgICBmdW5jdGlvbiBnZXRkZXRhaWxzKGFnZW50KSB7XHJcbiAgICAvLyAgICAgICAgIGFnZW50LmFkZChcIklwaG9uZVwiKTtcclxuICAgIC8vICAgICAgICAgUHJvZHVjdC5maW5kKHsgXCJwcm9kdWN0X25hbWVcIjogciB9LCBmdW5jdGlvbiAoZXJyLCBwcm9kdWN0KSB7XHJcbiAgICAvLyAgICAgICAgIHByb2R1Y3QuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuICAgIC8vICAgICAgICAgICAgIC8vY29uc29sZS5sb2coZWxlbWVudC5wcmljZSk7XHJcbiAgICAvLyAgICAgICAgICAgICBpZiAoZWxlbWVudC5wcm9kdWN0X25hbWUgPT09IHIpIHtcclxuICAgIC8vICAgICAgICAgICAgICAgICBhZ2VudC5hZGQoXCJOYW1lOiBcIitlbGVtZW50LnByb2R1Y3RfbmFtZSk7XHJcbiAgICAvLyAgICAgICAgICAgICAgICAgYWdlbnQuYWRkKFwiUHJpY2U6IFwiK2VsZW1lbnQucHJpY2UpO1xyXG4gICAgLy8gICAgICAgICAgICAgICAgIGFnZW50LmFkZChcIkNhdGVnb3J5OiBcIitlbGVtZW50LmNhdGVnb3J5KTtcclxuICAgIC8vICAgICAgICAgICAgIH1cclxuICAgIC8vICAgICAgICAgfSk7XHJcbiAgICAvLyAgICAgIH0pO1xyXG5cclxuICAgIC8vICAgICB9XHJcblxyXG5cclxuICAgIC8vICAgICBpbnRlbnRNYXAuc2V0KCdEZWZhdWx0IFdlbGNvbWUgSW50ZW50Jywgd2VsY29tZSk7XHJcbiAgICAvLyAgICAgaW50ZW50TWFwLnNldCgnRGVmYXVsdCBGYWxsYmFjayBJbnRlbnQnLCBmYWxsYmFjayk7XHJcbiAgICAvLyAgICAgaW50ZW50TWFwLnNldCgnQm9va0ZsaWdodCcsIGJvb2tGbGlnaHQpO1xyXG4gICAgLy8gICAgIGludGVudE1hcC5zZXQoJ0dldGRldGFpbHMnLCBnZXRkZXRhaWxzKTtcclxuICAgIC8vICAgICBhZ2VudC5oYW5kbGVSZXF1ZXN0KGludGVudE1hcCk7XHJcblxyXG4gICAgLy99KTtcclxuXHJcbi8vfVxyXG5cclxuZXhwb3J0cy5hZGQgPSBmdW5jdGlvbiAocmVxLCByZXMpIHtcclxuXHJcbiAgICB2YXIgbmV3X3Byb2R1Y3QgPSBuZXcgUHJvZHVjdChyZXEuYm9keSk7XHJcblxyXG4gICAgbmV3X3Byb2R1Y3Quc2F2ZShmdW5jdGlvbiAoZXJyLCBwcm9kdWN0KSB7XHJcblxyXG4gICAgICAgIGlmKGVycikge1xyXG4gICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHsgLy9JZiBubyBlcnJvcnMsIHNlbmQgaXQgYmFjayB0byB0aGUgY2xpZW50XHJcbiAgICAgICAgICAgIHJlcy5qc29uKHttZXNzYWdlOiBcIlByb2R1Y3Qgc3VjY2Vzc2Z1bGx5IGFkZGVkIVwiLCBwcm9kdWN0fSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG5cclxufTtcclxuXHJcblxyXG5cclxuZXhwb3J0cy51cGRhdGUgPSBmdW5jdGlvbiAocmVxLCByZXMpIHtcclxuXHJcbiAgICB2YXIgaWQgPSBtb25nb29zZS5UeXBlcy5PYmplY3RJZChyZXEucXVlcnkucHJvZHVjdElkKTtcclxuXHJcbiAgICBQcm9kdWN0LmZpbmRPbmVBbmRVcGRhdGUoeyBfaWQ6IGlkIH0sIHJlcS5ib2R5LCB7IG5ldzogdHJ1ZSB9LCBmdW5jdGlvbiAoZXJyLCBwcm9kdWN0KSB7XHJcblxyXG4gICAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgICAgIHJlcy5zZW5kKGVycik7XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHByb2R1Y3QpO1xyXG5cclxuICAgIH0pO1xyXG5cclxufTtcclxuXHJcbmV4cG9ydHMuZGVsZXRlID0gZnVuY3Rpb24gKHJlcSwgcmVzKSB7XHJcblxyXG4gICAgdmFyIGlkID0gbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQocmVxLnF1ZXJ5LnByb2R1Y3RJZCk7XHJcblxyXG4gICAgUHJvZHVjdC5yZW1vdmUoeyBfaWQ6IGlkIH0sIGZ1bmN0aW9uIChlcnIsIHByb2R1Y3QpIHtcclxuXHJcbiAgICAgICAgaWYgKGVycilcclxuICAgICAgICAgICAgcmVzLnNlbmQoZXJyKTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oeyBtZXNzYWdlOiAnUHJvZHVjdCBzdWNjZXNzZnVsbHkgZGVsZXRlZCcgfSk7XHJcblxyXG4gICAgfSk7XHJcblxyXG59OyJdfQ==